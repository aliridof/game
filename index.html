<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEMANTRAN - Advanced Roulette Analysis</title>
    <style>
        /* [KEEP ALL EXISTING CSS FROM RT-CL-V3.html] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
        }

        /* [REST OF YOUR EXISTING CSS REMAINS THE SAME] */
        /* ... semua CSS dari file sebelumnya ... */

        /* NEW STYLES FOR ANALYTICS INTEGRATION */
        .analytics-section {
            margin: 30px 0;
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
        }

        .analytics-title {
            text-align: center;
            font-size: 1.6em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .confidence-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .confidence-item {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            color: #2c3e50;
        }

        .confidence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
        }

        .confidence-category {
            font-weight: bold;
            font-size: 1.1em;
        }

        .confidence-level {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .level-minimal { background: #27ae60; color: white; }
        .level-low { background: #2ecc71; color: white; }
        .level-medium { background: #f39c12; color: white; }
        .level-high { background: #e67e22; color: white; }
        .level-very-high { background: #e74c3c; color: white; }
        .level-extreme { background: #c0392b; color: white; }

        .confidence-details {
            font-size: 0.9em;
        }

        .confidence-bar {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 8px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .recommendations {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: #2c3e50;
        }

        .recommendation-item {
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .recommendation-aggressive { border-left-color: #e74c3c; background: #ffeaea; }
        .recommendation-balanced { border-left-color: #f39c12; background: #fff4e6; }
        .recommendation-contrarian { border-left-color: #27ae60; background: #eafaf1; }
        .recommendation-warning { border-left-color: #c0392b; background: #fbeeee; }

        .intersection-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .intersection-number {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ KEMANTRAN - Advanced Analysis</h1>
            <div class="current-number" id="currentNumber">--</div>
        </div>

        <!-- Categories Horizontal Layout -->
        <div class="categories-horizontal">
            <!-- [KEEP ALL EXISTING CATEGORY GROUPS] -->
            <!-- DOZEN, COLUMN, BESAR-KECIL, GANJIL-GENAP, HITAM-MERAH -->
        </div>

        <!-- HOT KATEGORI Section -->
        <div class="hot-categories-section">
            <div class="hot-categories">
                <div class="hot-title">HOT KATEGORI (Streak > 5)</div>
                <div class="hot-content" id="hotContent">
                    <div class="no-hot-categories" id="noHotCategories">
                        Belum ada kategori yang HOT (Streak > 5)
                    </div>
                </div>
            </div>
        </div>

        <!-- ANALYTICS SECTION -->
        <div class="analytics-section">
            <div class="analytics-title">üìä ADVANCED ANALYTICS</div>
            <div class="confidence-matrix" id="confidenceMatrix">
                <!-- Confidence items will be populated by JavaScript -->
            </div>
            
            <div class="recommendations" id="recommendations">
                <h3>üí° SMART RECOMMENDATIONS</h3>
                <div id="recommendationsContent">
                    <!-- Recommendations will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Controls dengan Undo -->
        <div class="controls">
            <div class="main-controls">
                <input type="text" id="numberInput" placeholder="00" maxlength="2">
                <button onclick="addNumber()">TAMBAH</button>
                <button onclick="resetAll()">RESET</button>
            </div>
            <div class="undo-controls">
                <button class="undo-btn" onclick="undo()" id="undoBtn" disabled>
                    UNDO
                </button>
                <div class="undo-counter" id="undoCounter">
                    ‚Ü©Ô∏è 0/5
                </div>
            </div>
        </div>

        <!-- History Sections -->
        <div class="history-sections">
            <!-- Grid History -->
            <div class="history-section">
                <div class="history-title">HISTORY GRID (Last 100 Numbers)</div>
                <div class="history-grid" id="historyGrid"></div>
                <div class="history-counter" id="gridCounter">Total: 0 numbers</div>
            </div>

            <!-- Vertical History -->
            <div class="history-section">
                <div class="history-title">DETAIL HISTORY</div>
                <div class="vertical-history" id="verticalHistory"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== TOP-STRIKE ANALYZER INTEGRATION ====================
        class TopStrikeAnalyzer {
            constructor() {
                this.topStrikeRecord = {
                    d0: 0, d1: 0, d2: 0, d3: 0,
                    c0: 0, c1: 0, c2: 0, c3: 0,
                    zeroSize: 0, small: 0, big: 0,
                    zeroParity: 0, even: 0, odd: 0,
                    zeroColor: 0, red: 0, black: 0
                };
                
                this.currentStreaks = {};
                this.historyData = [];
                this.resetPatterns = [];
                this.coldHotNumbers = {};
                this.frequencyData = {};
            }

            // [KEEP ALL ANALYZER METHODS FROM RT-SCRIPT.js]
            // ... semua method dari RT-SCRIPT.js ...

            // Helper methods untuk integrasi
            getNumberCategories(number) {
                return {
                    dozen: this.getDozen(number),
                    column: this.getColumn(number),
                    size: this.getSize(number),
                    parity: this.getParity(number),
                    color: this.getColor(number)
                };
            }

            getDozen(number) {
                if (number === 0) return 'd0';
                if (number <= 12) return 'd1';
                if (number <= 24) return 'd2';
                return 'd3';
            }

            getColumn(number) {
                if (number === 0) return 'c0';
                return 'c' + ((number % 3) || 3);
            }

            getSize(number) {
                if (number === 0) return 'zeroSize';
                return number <= 18 ? 'small' : 'big';
            }

            getParity(number) {
                if (number === 0) return 'zeroParity';
                return number % 2 === 0 ? 'even' : 'odd';
            }

            getColor(number) {
                if (number === 0) return 'zeroColor';
                const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
                return redNumbers.includes(number) ? 'red' : 'black';
            }

            // [REST OF THE METHODS FROM RT-SCRIPT.js]
            // ... updateTopStrikeRecords, calculateConfidenceLevel, dll ...
        }

        // ==================== GLOBAL VARIABLES ====================
        const analyzer = new TopStrikeAnalyzer();
        let history = [];
        let undoStack = [];
        const MAX_UNDO = 5;

        // ==================== DOM ELEMENTS ====================
        const elements = {
            numberInput: document.getElementById('numberInput'),
            currentNumber: document.getElementById('currentNumber'),
            undoBtn: document.getElementById('undoBtn'),
            undoCounter: document.getElementById('undoCounter'),
            hotContent: document.getElementById('hotContent'),
            noHotCategories: document.getElementById('noHotCategories'),
            confidenceMatrix: document.getElementById('confidenceMatrix'),
            recommendationsContent: document.getElementById('recommendationsContent')
        };

        // ==================== STREAK DISPLAY CONFIG ====================
        const streakElements = {
            'd0': 'd0-value', 'd1': 'd1-value', 'd2': 'd2-value', 'd3': 'd3-value',
            'c0': 'c0-value', 'c1': 'c1-value', 'c2': 'c2-value', 'c3': 'c3-value',
            'zeroSize': 'zero-size-value', 'small': 'small-value', 'big': 'big-value',
            'zeroParity': 'zero-parity-value', 'even': 'even-value', 'odd': 'odd-value',
            'zeroColor': 'zero-color-value', 'red': 'red-value', 'black': 'black-value'
        };

        // ==================== MAIN FUNCTIONS ====================
        function addNumber() {
            const input = elements.numberInput.value.trim();
            if (!input) return;

            const number = parseInt(input);
            if (isNaN(number) || number < 0 || number > 36) {
                alert('Masukkan angka antara 0-36');
                return;
            }

            // Save current state for undo
            if (undoStack.length >= MAX_UNDO) {
                undoStack.shift();
            }
            undoStack.push([...history]);

            // Add to history
            history.push({
                number: number,
                timestamp: new Date(),
                categories: analyzer.getNumberCategories(number)
            });

            // Update analyzer
            analyzer.updateTopStrikeRecords(history);
            
            // Update UI
            updateStreakDisplays();
            updateHotCategories();
            updateAnalytics();
            updateHistoryDisplays();
            updateUndoButton();

            // Clear input
            elements.numberInput.value = '';
            elements.numberInput.focus();
        }

        function undo() {
            if (undoStack.length === 0) return;

            history = undoStack.pop();
            analyzer.updateTopStrikeRecords(history);
            
            updateStreakDisplays();
            updateHotCategories();
            updateAnalytics();
            updateHistoryDisplays();
            updateUndoButton();
        }

        function resetAll() {
            if (!confirm('Reset semua data?')) return;

            history = [];
            undoStack = [];
            analyzer.updateTopStrikeRecords(history);
            
            updateStreakDisplays();
            updateHotCategories();
            updateAnalytics();
            updateHistoryDisplays();
            updateUndoButton();
        }

        // ==================== UI UPDATE FUNCTIONS ====================
        function updateStreakDisplays() {
            // Reset all streaks to 0
            Object.keys(streakElements).forEach(key => {
                const element = document.getElementById(streakElements[key]);
                if (element) element.textContent = '00';
            });

            if (history.length === 0) return;

            // Calculate current streaks
            const currentStreaks = analyzer.getInitialStreaks();
            const lastNumber = history[history.length - 1].number;
            const categories = analyzer.getNumberCategories(lastNumber);

            Object.values(categories).forEach(category => {
                if (currentStreaks.hasOwnProperty(category)) {
                    currentStreaks[category] = 1;
                    
                    // Count backward to find streak length
                    for (let i = history.length - 2; i >= 0; i--) {
                        const prevCategories = analyzer.getNumberCategories(history[i].number);
                        if (Object.values(prevCategories).includes(category)) {
                            currentStreaks[category]++;
                        } else {
                            break;
                        }
                    }
                }
            });

            // Update display
            Object.keys(currentStreaks).forEach(key => {
                const element = document.getElementById(streakElements[key]);
                if (element) {
                    const streak = currentStreaks[key];
                    element.textContent = streak.toString().padStart(2, '0');
                    
                    // Update color based on streak length
                    element.className = 'streak-value ';
                    if (streak >= 8) element.classList.add('streak-high');
                    else if (streak >= 5) element.classList.add('streak-medium');
                    else element.classList.add('streak-normal');
                }
            });

            // Update current number display
            elements.currentNumber.textContent = lastNumber.toString().padStart(2, '0');
        }

        function updateHotCategories() {
            const hotCategories = [];
            const currentStreaks = getCurrentStreaks();

            Object.keys(currentStreaks).forEach(category => {
                if (currentStreaks[category] > 5) {
                    hotCategories.push({
                        category: category,
                        streak: currentStreaks[category],
                        label: getCategoryLabel(category)
                    });
                }
            });

            if (hotCategories.length === 0) {
                elements.noHotCategories.style.display = 'block';
                elements.hotContent.innerHTML = '';
                elements.hotContent.appendChild(elements.noHotCategories);
                return;
            }

            elements.noHotCategories.style.display = 'none';
            
            // Group by category type
            const grouped = {
                dozen: [],
                column: [],
                size: [],
                parity: [],
                color: []
            };

            hotCategories.forEach(item => {
                if (item.category.startsWith('d')) grouped.dozen.push(item);
                else if (item.category.startsWith('c')) grouped.column.push(item);
                else if (item.category.includes('Size')) grouped.size.push(item);
                else if (item.category.includes('Parity') || item.category === 'even' || item.category === 'odd') grouped.parity.push(item);
                else if (item.category.includes('Color') || item.category === 'red' || item.category === 'black') grouped.color.push(item);
            });

            let html = '';
            Object.keys(grouped).forEach(type => {
                if (grouped[type].length > 0) {
                    html += `
                        <div class="hot-category-group">
                            <div class="hot-category-title">${type.toUpperCase()}</div>
                            <div class="hot-category-items">
                    `;
                    
                    grouped[type].forEach(item => {
                        html += `
                            <div class="hot-item">
                                <span class="hot-item-label">${item.label}</span>
                                <span class="hot-item-value">${item.streak}</span>
                            </div>
                        `;
                    });
                    
                    html += `</div></div>`;
                }
            });

            elements.hotContent.innerHTML = html;
        }

        function updateAnalytics() {
            const currentStreaks = getCurrentStreaks();
            const analysis = analyzer.analyzeIntersectionWithConfidence(currentStreaks);
            
            // Update Confidence Matrix
            updateConfidenceMatrix(analysis.confidenceMatrix);
            
            // Update Recommendations
            updateRecommendations(analysis.recommendations);
        }

        function updateConfidenceMatrix(confidenceMatrix) {
            let html = '';
            
            Object.keys(confidenceMatrix).forEach(category => {
                const confidence = confidenceMatrix[category];
                if (confidence.percentage > 0) {
                    const levelClass = `level-${confidence.level.toLowerCase().replace('_', '-')}`;
                    
                    html += `
                        <div class="confidence-item">
                            <div class="confidence-header">
                                <span class="confidence-category">${getCategoryLabel(category)}</span>
                                <span class="confidence-level ${levelClass}">${confidence.level}</span>
                            </div>
                            <div class="confidence-details">
                                <div>Streak: ${confidence.currentStreak} / ${confidence.topStrike}</div>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${confidence.percentage}%; background: ${getConfidenceColor(confidence.percentage)}"></div>
                                </div>
                                <div>Risk: ${confidence.risk} ‚Ä¢ ${confidence.percentage}%</div>
                            </div>
                        </div>
                    `;
                }
            });

            elements.confidenceMatrix.innerHTML = html || '<div class="confidence-item">No significant confidence data yet</div>';
        }

        function updateRecommendations(recommendations) {
            let html = '';
            
            if (recommendations.length === 0) {
                html = '<div class="recommendation-item">Tambah lebih banyak data untuk mendapatkan rekomendasi</div>';
            } else {
                recommendations.forEach(rec => {
                    const typeClass = `recommendation-${rec.type.toLowerCase()}`;
                    
                    html += `
                        <div class="recommendation-item ${typeClass}">
                            <strong>${rec.type}</strong>: ${rec.message}
                            ${rec.numbers ? `
                                <div class="intersection-numbers">
                                    ${rec.numbers.map(num => `<span class="intersection-number">${num}</span>`).join('')}
                                </div>
                            ` : ''}
                            ${rec.confidence ? `<div><small>Confidence: ${rec.confidence}% ‚Ä¢ Risk: ${rec.risk}</small></div>` : ''}
                        </div>
                    `;
                });
            }
            
            elements.recommendationsContent.innerHTML = html;
        }

        // ==================== HELPER FUNCTIONS ====================
        function getCurrentStreaks() {
            const streaks = analyzer.getInitialStreaks();
            if (history.length === 0) return streaks;

            const lastNumber = history[history.length - 1].number;
            const categories = analyzer.getNumberCategories(lastNumber);

            Object.values(categories).forEach(category => {
                if (streaks.hasOwnProperty(category)) {
                    streaks[category] = 1;
                    
                    for (let i = history.length - 2; i >= 0; i--) {
                        const prevCategories = analyzer.getNumberCategories(history[i].number);
                        if (Object.values(prevCategories).includes(category)) {
                            streaks[category]++;
                        } else {
                            break;
                        }
                    }
                }
            });

            return streaks;
        }

        function getCategoryLabel(category) {
            const labels = {
                'd0': 'Dozen 0', 'd1': 'Dozen 1', 'd2': 'Dozen 2', 'd3': 'Dozen 3',
                'c0': 'Column 0', 'c1': 'Column 1', 'c2': 'Column 2', 'c3': 'Column 3',
                'zeroSize': 'Zero Size', 'small': 'Small', 'big': 'Big',
                'zeroParity': 'Zero Parity', 'even': 'Even', 'odd': 'Odd',
                'zeroColor': 'Zero Color', 'red': 'Red', 'black': 'Black'
            };
            return labels[category] || category;
        }

        function getConfidenceColor(percentage) {
            if (percentage >= 90) return '#c0392b';
            if (percentage >= 75) return '#e74c3c';
            if (percentage >= 60) return '#e67e22';
            if (percentage >= 40) return '#f39c12';
            if (percentage >= 20) return '#2ecc71';
            return '#27ae60';
        }

        function updateUndoButton() {
            elements.undoBtn.disabled = undoStack.length === 0;
            elements.undoCounter.textContent = `‚Ü©Ô∏è ${undoStack.length}/${MAX_UNDO}`;
        }

        // ==================== HISTORY DISPLAY FUNCTIONS ====================
        function updateHistoryDisplays() {
            updateGridHistory();
            updateVerticalHistory();
        }

        function updateGridHistory() {
            const grid = document.getElementById('historyGrid');
            const counter = document.getElementById('gridCounter');
            
            let html = '';
            const displayHistory = history.slice(-100).reverse();
            
            displayHistory.forEach(entry => {
                const color = entry.number === 0 ? 'green' : 
                            [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(entry.number) ? 'red' : 'black';
                
                html += `<div class="history-number" style="background: ${color}">${entry.number}</div>`;
            });
            
            grid.innerHTML = html;
            counter.textContent = `Total: ${history.length} numbers`;
        }

        function updateVerticalHistory() {
            const container = document.getElementById('verticalHistory');
            let html = '';
            
            const displayHistory = history.slice(-20).reverse();
            
            displayHistory.forEach((entry, index) => {
                const categories = analyzer.getNumberCategories(entry.number);
                const color = entry.number === 0 ? 'green' : 
                            [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(entry.number) ? 'red' : 'black';
                
                html += `
                    <div class="history-item">
                        <div class="history-number-large" style="background: ${color}">${entry.number}</div>
                        <div class="history-details">
                            <div class="history-detail-item">
                                <span class="history-detail-label">Kategori:</span>
                                <span class="history-detail-value">
                                    ${Object.values(categories).join(', ')}
                                </span>
                            </div>
                            <div class="history-detail-item">
                                <span class="history-detail-label">Waktu:</span>
                                <span class="history-detail-value">
                                    ${entry.timestamp.toLocaleTimeString()}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html || '<div style="text-align: center; padding: 20px; color: #7f8c8d;">No history yet</div>';
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            elements.numberInput.focus();
            updateStreakDisplays();
            updateUndoButton();
            
            // Enter key support
            elements.numberInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addNumber();
            });
        });

        // [REST OF THE TopStrikeAnalyzer METHODS FROM RT-SCRIPT.js]
        // ... paste semua method yang ada di RT-SCRIPT.js di sini ...
    </script>
</body>
</html>